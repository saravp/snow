<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[var app = angular.module('otSettings', []);
app.controller('otSettingsCtrl', function ($scope) {
    $scope.apiKeyValue = '';
    $scope.envValue = '';
    $scope.notificationVal = false;
    var insert = true;
    var previousValue = '';
	var initialSettingsRecord;
    
    $scope.onInitCode = (function () {
        this.initialSettingsRecord = new GlideRecord('x_261942_ot_apikey');
        this.initialSettingsRecord.orderByDesc('sys_created_on');
        this.initialSettingsRecord.setLimit(1);
        this.initialSettingsRecord.query();
		console.log("initial value record" + JSON.stringify(this.initialSettingsRecord));
        if (this.initialSettingsRecord.next()) {
            insert = false;
            $scope.apiKeyValue = this.initialSettingsRecord.apikey;
            $scope.envValue = this.initialSettingsRecord.url;
            previousValue = $scope.apiKeyValue;
            $scope.envValue = this.initialSettingsRecord.url;
            $scope.notificationVal = this.initialSettingsRecord.notification_s;
        }
    })();
    
    $scope.onSettingSubmit = function () {
        if (insert && $scope.apiKeyValue && $scope.envValue) {
            var getSettingsParams = new GlideRecord('x_261942_ot_apikey');
            getSettingsParams.initialize();
            getSettingsParams.setValue('apikey', $scope.apiKeyValue);
            getSettingsParams.setValue('url', $scope.envValue);
            getSettingsParams.setValue('notification_s', $scope.notificationVal);
            getSettingsParams.insert();
        } else if ($scope.apiKeyValue && $scope.envValue){
            this.initialSettingsRecord = new GlideRecord('x_261942_ot_apikey');
			console.log("on submit value record" + JSON.stringify(this.initialSettingsRecord));
            this.initialSettingsRecord.addQuery('apikey', previousValue);
            this.initialSettingsRecord.query();
            while (this.initialSettingsRecord.next()) {
                this.initialSettingsRecord.setValue('apikey', $scope.apiKeyValue);
                this.initialSettingsRecord.setValue('url', $scope.envValue);
                this.initialSettingsRecord.setValue('notification_s', $scope.notificationVal);
                this.initialSettingsRecord.update();
            }
        } else {
            alert("Please fill both the fields");
        }
        
    };
    
    
});]]></client_script>
        <description>This is the UI page for setting up the integration</description>
        <direct>false</direct>
        <endpoint>x_261942_ot_Settings.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    </link>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    </link>
    <style>
        .ot-settings__form {
            max-width: 750px;
            padding-top: 30px;
			font-family: 'Open Sans', sans-serif;
			font-size: 12px;
        }
		
		.ot-settings__primary-btn {
            margin: 0 0.5rem 0 0.5rem;
            border-radius: 2rem;
		    margin-top: 10px;
			background-color: #1f96db;
			border-color: #1f96db;
        }
		
		.ot-settings__primary-btn:hover {
			background-color: #1f96db;
			border-color: #1f96db;
        }
		
		.ot-settings__primary-btn:active {
			background-color: #1f96db;
			border-color: #1f96db;
			outline-style: none;
		}

        .ot-settings {
            font-size: 1.2rem;
            font-family: 'Open Sans', sans-serif;
        }
        .ot-settings__header {
            padding: 2rem 3rem 2rem 3rem;
            font-weight: 300;
        }
    </style>

    <body class="ot-settings" ng-app="otSettings">
        <div ng-controller="otSettingsCtrl">
            <h2 class="ot-settings__header">OneTrust Settings</h2>
            <div class="container ot-settings__form">
                <form>
                    <fieldset class="form-group">
                        <label for="otSettingsApiKey">Api Key</label>
                        <input type="text" class="form-control" id="otSettingsApiKey" placeholder="Please Enter OneTrust ApiKey"
                            ng-model="apiKeyValue" ng-change="onApiKeyChanges()" ng-value="apiKeyValue" />
                    </fieldset>
                    <fieldset class="form-group">
                        <label for="otSettingsEnv">Environment URL</label>
                        <input type="text" class="form-control" id="exampleInputPassword1" placeholder="Please Enter OneTrust Environment"
                            ng-model="envValue" ng-value="envValue" ng-change="onEnvChnage(envValue)" />
                    </fieldset>
                    <!-- <div class="checkbox">
                        <label style="font-weight: bold;">
                            <input type="checkbox" ng-model="notificationVal" id="notificationcheck" name="emailNotification"
                                value="notificationVal" />
                            Email Notification
                        </label>
                    </div> -->
                    <button type="submit" class="btn btn-primary ot-settings__primary-btn" ng-click="onSettingSubmit()"
                        onclick="window.location.reload(true);">Submit</button>
                </form>
            </div>
        </div>
    </body>
</j:jelly>]]></html>
        <name>Settings</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-10-05 21:20:53</sys_created_on>
        <sys_id>4f3e87904fc96300f20f1b818110c758</sys_id>
        <sys_mod_count>27</sys_mod_count>
        <sys_name>Settings</sys_name>
        <sys_package display_value="OT" source="x_261942_ot">2fd4a5334f231300f20f1b818110c702</sys_package>
        <sys_policy/>
        <sys_scope display_value="OT">2fd4a5334f231300f20f1b818110c702</sys_scope>
        <sys_update_name>sys_ui_page_4f3e87904fc96300f20f1b818110c758</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-10-08 18:56:59</sys_updated_on>
    </sys_ui_page>
</record_update>
